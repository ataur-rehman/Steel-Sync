<!DOCTYPE html>
<html>

<head>
    <title>Debug Entry ID 12</title>
</head>

<body>
    <h1>Entry ID 12 Analysis</h1>
    <button onclick="analyzeEntry12()">Analyze Entry ID 12</button>
    <button onclick="findSimilarEntries()">Find Similar Entries</button>
    <button onclick="showAllTodayEntries()">Show All Today's Entries</button>
    <div id="results"></div>

    <script>
        // Initialize database connection
        let db;

        async function initDB() {
            try {
                const { DatabaseService } = await import('./src/services/database.ts');
                db = new DatabaseService();
                await db.initialize();
                console.log('Database initialized');
            } catch (error) {
                console.error('Failed to initialize database:', error);
            }
        }

        async function analyzeEntry12() {
            if (!db) await initDB();

            const results = document.getElementById('results');
            results.innerHTML = '<h2>Analyzing Entry ID 12...</h2>';

            try {
                // Get entry ID 12 specifically
                const entry12 = await db.executeRawQuery(
                    'SELECT * FROM ledger_entries WHERE id = ?', [12]
                );

                if (entry12.length > 0) {
                    results.innerHTML += '<h3>‚úÖ Entry ID 12 Found:</h3>';
                    results.innerHTML += '<pre>' + JSON.stringify(entry12[0], null, 2) + '</pre>';

                    // Check for entries with same characteristics
                    const similar = await db.executeRawQuery(`
                        SELECT * FROM ledger_entries 
                        WHERE customer_id = ? AND amount = ? AND date = ? AND reference_id = ?
                        ORDER BY id
                    `, [
                        entry12[0].customer_id,
                        entry12[0].amount,
                        entry12[0].date,
                        entry12[0].reference_id
                    ]);

                    results.innerHTML += '<h3>üîç Similar Entries:</h3>';
                    results.innerHTML += '<pre>' + JSON.stringify(similar, null, 2) + '</pre>';

                } else {
                    results.innerHTML += '<h3>‚ùå Entry ID 12 NOT FOUND</h3>';
                }

            } catch (error) {
                results.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        async function findSimilarEntries() {
            if (!db) await initDB();

            const results = document.getElementById('results');
            results.innerHTML += '<h2>Finding Potentially Similar Entries...</h2>';

            try {
                // Find groups of entries that might be duplicates
                const duplicateGroups = await db.executeRawQuery(`
                    SELECT 
                        customer_id, amount, date, reference_id, reference_type,
                        COUNT(*) as count,
                        GROUP_CONCAT(id) as entry_ids
                    FROM ledger_entries 
                    WHERE date >= date('now', '-7 days')
                    GROUP BY customer_id, amount, date, reference_id, reference_type
                    HAVING COUNT(*) > 1
                    ORDER BY count DESC
                `);

                results.innerHTML += '<h3>üîÑ Potential Duplicate Groups:</h3>';
                results.innerHTML += '<pre>' + JSON.stringify(duplicateGroups, null, 2) + '</pre>';

            } catch (error) {
                results.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        async function showAllTodayEntries() {
            if (!db) await initDB();

            const results = document.getElementById('results');
            results.innerHTML += '<h2>All Today\'s Entries...</h2>';

            try {
                const today = new Date().toISOString().split('T')[0];
                const todayEntries = await db.executeRawQuery(
                    'SELECT * FROM ledger_entries WHERE date = ? ORDER BY id', [today]
                );

                results.innerHTML += '<h3>üìÖ Today\'s Entries (' + today + '):</h3>';
                results.innerHTML += '<pre>' + JSON.stringify(todayEntries, null, 2) + '</pre>';

            } catch (error) {
                results.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        // Initialize when page loads
        window.addEventListener('load', initDB);
    </script>
</body>

</html>